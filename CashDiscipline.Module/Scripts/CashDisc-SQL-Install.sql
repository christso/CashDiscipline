-- THIS line fail on SQL Azure, don't worry!
sp_configure 'clr enabled', 1;
GO
RECONFIGURE;
GO

PRINT N'Uninstall old version...';
GO

IF OBJECT_ID('dbo.BOMONTH') IS NOT NULL
	BEGIN		
		DROP FUNCTION dbo.BoMonth;
	END;

GO

IF OBJECT_ID('dbo.REGEXP') IS NOT NULL
	BEGIN		
		DROP FUNCTION dbo.REGEXP;
	END;

GO

IF EXISTS ( SELECT  1
			FROM    sys.assemblies
			WHERE   name = 'CashDiscipline.SqlServer' )
	BEGIN
		DROP ASSEMBLY [CashDiscipline.SqlServer];
	END;

GO

PRINT N'Install';
GO

CREATE ASSEMBLY [CashDiscipline.SqlServer]
    AUTHORIZATION [dbo]
    FROM 0x4D5A90000300000004000000FFFF0000B800000000000000400000000000000000000000000000000000000000000000000000000000000000000000800000000E1FBA0E00B409CD21B8014CCD21546869732070726F6772616D2063616E6E6F742062652072756E20696E20444F53206D6F64652E0D0D0A2400000000000000504500004C0103009AB2B7570000000000000000E00002210B010B00000800000006000000000000EE260000002000000040000000000010002000000002000004000000000000000600000000000000008000000002000000000000030060850000100000100000000010000010000000000000100000000000000000000000A02600004B00000000400000E802000000000000000000000000000000000000006000000C000000682500001C0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000200000080000000000000000000000082000004800000000000000000000002E74657874000000F4060000002000000008000000020000000000000000000000000000200000602E72737263000000E80200000040000000040000000A0000000000000000000000000000400000402E72656C6F6300000C0000000060000000020000000E00000000000000000000000000004000004200000000000000000000000000000000D0260000000000004800000002000500B8200000B004000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001330030022000000010000110F00280500000A0A12001200280600000A6517586C280700000A0A06730800000A2A00001330020022000000020000110F01280900000A730A00000A0A060F00280900000A6F0B00000A0B07730C00000A2A1E02280D00000A2A000042534A4201000100000000000C00000076342E302E33303331390000000005006C000000A8010000237E000014020000F001000023537472696E6773000000000404000008000000235553000C0400001000000023475549440000001C0400009400000023426C6F620000000000000002000001471502000900000000FA253300160000010000000B0000000200000003000000030000000D0000000500000002000000010000000300000000000A0001000000000006004C0045000A0074005F000A0088005F000A0093005F000600D300C0001700E700000006001601F60006003601F6000A0088016D0106009D0145000E00DF01C00100000000010000000000010001000100100027000000050001000100502000000000960080000A00010080200000000096009D0011000200AE20000000008618A4001A00040000000100AA0000000100B20000000200B8002900A4001E003900A40024004100A4001A004900A4001A001100A6012E005100B00133005100B80137001100A4003D002100A60148005900A4004C005900E50151001900A40056000900A4001A002000230029002E000B0061002E0013006A002E001B00730040002300290043005B000480000000000000000000000000000000005401000004000000000000000000000001003C0000000000040000000000000000000000010053000000000004000000000000000000000001004500000000000000003C4D6F64756C653E00436173684469736369706C696E652E53716C5365727665722E646C6C0055736572446566696E656446756E6374696F6E73006D73636F726C69620053797374656D004F626A6563740053797374656D2E446174610053797374656D2E446174612E53716C54797065730053716C4461746554696D6500424F4D4F4E54480053716C426F6F6C65616E0053716C537472696E6700524547455850002E63746F720073716C4461746500696E707574007061747465726E0053797374656D2E446961676E6F73746963730044656275676761626C6541747472696275746500446562756767696E674D6F6465730053797374656D2E52756E74696D652E436F6D70696C6572536572766963657300436F6D70696C6174696F6E52656C61786174696F6E734174747269627574650052756E74696D65436F6D7061746962696C69747941747472696275746500436173684469736369706C696E652E53716C536572766572004D6963726F736F66742E53716C5365727665722E5365727665720053716C46756E6374696F6E417474726962757465004461746554696D65006765745F56616C7565006765745F44617900416464446179730053797374656D2E546578742E526567756C617245787072657373696F6E730052656765780049734D61746368000000000003200000000000A6250660864F37498FD7DCCCA538099E0008B77A5C561934E08906000111091109080002110D11111111032000010520010111190420010108040100000004200011290320000805200111290D05200101112904070111290320000E042001010E042001020E0420010102050702122D020801000200000000000801000800000000001E01000100540216577261704E6F6E457863657074696F6E5468726F7773010000000000009AB2B75700000000020000001C01000084250000840700005253445329E8CC66ADFE6E45BCDAE034CF1F903E05000000643A5C4354534F5C446174615C56697375616C2053747564696F5C4163746976652050726F6A656374735C43617368204469736369706C696E655C43617368446973632E53514C534552565C6F626A5C52656C656173655C436173684469736369706C696E652E53716C5365727665722E706462000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000C82600000000000000000000DE260000002000000000000000000000000000000000000000000000D02600000000000000005F436F72446C6C4D61696E006D73636F7265652E646C6C0000000000FF250020001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001001000000018000080000000000000000000000000000001000100000030000080000000000000000000000000000001000000000048000000584000008C02000000000000000000008C0234000000560053005F00560045005200530049004F004E005F0049004E0046004F0000000000BD04EFFE00000100000000000000000000000000000000003F000000000000000400000002000000000000000000000000000000440000000100560061007200460069006C00650049006E0066006F00000000002400040000005400720061006E0073006C006100740069006F006E00000000000000B004EC010000010053007400720069006E006700460069006C00650049006E0066006F000000C801000001003000300030003000300034006200300000002C0002000100460069006C0065004400650073006300720069007000740069006F006E000000000020000000300008000100460069006C006500560065007200730069006F006E000000000030002E0030002E0030002E00300000005C001D00010049006E007400650072006E0061006C004E0061006D006500000043006100730068004400690073006300690070006C0069006E0065002E00530071006C005300650072007600650072002E0064006C006C00000000002800020001004C006500670061006C0043006F00700079007200690067006800740000002000000064001D0001004F0072006900670069006E0061006C00460069006C0065006E0061006D006500000043006100730068004400690073006300690070006C0069006E0065002E00530071006C005300650072007600650072002E0064006C006C0000000000340008000100500072006F006400750063007400560065007200730069006F006E00000030002E0030002E0030002E003000000038000800010041007300730065006D0062006C0079002000560065007200730069006F006E00000030002E0030002E0030002E00300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002000000C000000F03600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000;

GO

CREATE FUNCTION [dbo].[BOMONTH]
(@sqlDate DATETIME NULL)
RETURNS DATETIME
AS
 EXTERNAL NAME [CashDiscipline.SqlServer].[UserDefinedFunctions].[BOMONTH]
GO

CREATE FUNCTION [dbo].[REGEXP]
(@input NVARCHAR (MAX) NULL, @pattern NVARCHAR (MAX) NULL)
RETURNS BIT
AS
 EXTERNAL NAME [CashDiscipline.SqlServer].[UserDefinedFunctions].[REGEXP]
GO